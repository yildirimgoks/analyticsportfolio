---
title: "R Notebook"
output: html_notebook
---

```{r}
install.packages("tidyverse", dependencies = T)
install.packages("stringi", dependencies=TRUE)
install.packages("scales")
install.packages("ggrepel")
install.packages("ggplot2")
install.packages("ggridges")
install.packages("colorspace")
devtools::install_version("cldr",version="1.1.0")
install.packages(c("extrafontdb", "extrafont", "Rttf2pt1"))
install.packages('rvest')
install.packages("gghighlight", dependencies = T)
install.packages("devtools")
install.packages("tidytext")

library("tidyverse")
library("ggplot2")
library("ggrepel")
library("scales")
library("devtools")
library("cldr")
library("tidytext")
library("ggridges")
library("rvest")
library("RColorBrewer")
library("gghighlight")

library("extrafontdb")
library("Rttf2pt1")
library("extrafont")
loadfonts(device="win")

update.packages()
```

Data setleri import ediyoruz

```{r}
read_imdb <- function(data_path) {
  path <- "C:/Users/Goksu/Desktop/Data Sciency/imdb/"
  read_tsv(paste0(path, data_path), na = "\\N", quote='', progress=F)
}

title_ratings <- read_imdb("title.ratings.tsv")
title_basics <- read_imdb("title.basics.tsv")
title_akas <- read_imdb("title.akas.tsv", na="\\N")

name_basics <- read_tsv("name.basics.tsv", na="\\N")
title_principles <- read_imdb("title.principals.tsv")
academy_awards <- read.csv("academy_awards.csv", stringsAsFactors = FALSE)
oscars_2015 <- read.csv("oscars_2015.csv", stringsAsFactors = FALSE)
```

Data setleri birleÅŸtiriyoruz
```{r}
ratings_title <- inner_join(title_ratings, title_basics)
```

600K satÄ±rÄ± filtreliyoruz. Kriterler: oylar, dil, tarih, ve movie
```{r}
ratings_title_filtered <- ratings_title %>% filter(numVotes > 1000 & titleType == "movie" & startYear > 1934) %>% cbind(full_tconst_new_country)
ratings_title_filtered <- ratings_title_filtered %>% filter(Country %in% c("USA", "UK"))
```

Genres sÃ¼tununda genreler virgÃ¼lle ayrÄ±lmÄ±ÅŸtÄ±, onu unnestliyoruz.
```{r}
ratings_title_filtered <- ratings_title_filtered %>% unnest_tokens(genre, genres) %>% select(tconst, averageRating, numVotes, originalTitle, isAdult, startYear, runtimeMinutes, genre, Country)
```

Name basics'i kÃ¼Ã§Ã¼lt, sadece aktÃ¶r/aktrisler kalsÄ±n
```{r}
name_basics <- name_basics %>% filter(str_detect(primaryProfession, "actor|actress|director|writer")) %>% select(nconst, primaryName, birthYear, deathYear)
```

title principles'i kÃ¼Ã§Ã¼lt, sadece filtered listemizdeki filmler kalsÄ±n
```{r}
title_principles <- inner_join(title_principles, ratings_title_filtered) %>% select(tconst, originalTitle, ordering, nconst, category, characters) %>% filter(category %in% c("actor", "actress", "director", "producer", "writer")) %>% unique
```

iÅŸi bitenleri kaldÄ±ralÄ±mW
```{r}
remove("ratings_title_english")
remove("ratings_title")
remove("language_results")
remove("title_akas")
remove("title_basics")
remove("title_ratings")
```

FarklÄ± isim altÄ±ndaki writing ve best picture kategorilerini birleÅŸtir
```{r}
#WRITING
adapted_screenplay_syn <- c("Writing (Screenplay Based on Material Previously Produced or Published)", "Writing (Screenplay, Based on Material from Another Medium)", "Writing (Screenplay Based on Material from Another Medium)", "Writing (Adaptation)", "Writing (Screenplay, Adapted)", "Writing (Screenplay)") 

original_screenplay_syn <- c("Writing (Original Story)", "Writing (Screenplay, Original)", "Writing (Story and Screenplay, Based on Factual Material or Material Not Previously Published or Produced)", "Writing (Story and Screenplay, Based on Material Not Previously Published or Produced)", "Writing (Story and Screenplay, Written Directly for the Screen)", "Writing (Story and Screenplay)")

academy_awards <- academy_awards %>%
  mutate(Award = replace(Award, which(Award %in% original_screenplay_syn), "Writing (Original Screenplay)")) %>%  
  mutate(Award = replace(Award, which(Award %in% adapted_screenplay_syn), "Writing (Adapted Screenplay)"))

#BEST PICTURE  
best_picture_syn <- c("Best Picture", "Best Motion Picture", "Outstanding Motion Picture", "Outstanding Production")
academy_awards <- academy_awards %>% mutate(Award = replace(Award, which(Award %in% best_picture_syn), "Best Picture"))

academy_awards %>% filter(Award=="Best Picture")

#ACTOR & ACTRESS
academy_awards <- academy_awards %>% mutate(Award = replace(Award, which(Award == "Actor"), "Actor in a Leading Role"))
academy_awards <- academy_awards %>% mutate(Award = replace(Award, which(Award == "Actress"), "Actress in a Leading Role"))

#FILTER YEARS
years <- c(1934:2015) %>% as.character
academy_awards <- academy_awards %>% filter(Year %in% years)

#FILTER AWARDS
awards <- c("Writing (Original Screenplay)", "Writing (Adapted Screenplay)", "Best Picture", "Actor in a Leading Role", "Actress in a Leading Role","Actress in a Supporting Role","Actor in a Supporting Role", "Directing")
academy_awards <- academy_awards %>%  filter(Award %in% awards)

academy_awards$Award <- academy_awards$Award %>% as.factor
  
academy_awards <- academy_awards %>% select(Year, Award, Winner, Name, Film) %>% rbind(oscars_2015)
```

Ratings_title_filtered'a oscar bilgisini ekleyelim
```{r}
oscar_winners <- academy_awards %>% filter(Winner == 1 & Award == "Best Picture") %>% select(Name) %>% unlist %>% unname %>% as.vector %>% str_trim
oscar_nominees <- academy_awards %>% filter(is.na(Winner) & Award == "Best Picture") %>% select(Name) %>% unlist %>% unname %>% as.vector %>% str_trim

ratings_title_filtered$oscarStatus <- "None"

ratings_title_filtered <- ratings_title_filtered %>%
  mutate(oscarStatus = replace(oscarStatus, which(originalTitle %in% oscar_winners), "Won")) %>% 
  mutate(oscarStatus = replace(oscarStatus, which(originalTitle %in% oscar_nominees), "Nominated"))

ratings_title_filtered %>% str

ratings_title_filtered$genre <- as.factor(ratings_title_filtered$genre)
ratings_title_filtered$oscarStatus <- as.factor(ratings_title_filtered$oscarStatus)
```

### Let's Cook.

Bir takÄ±m dataviz
```{r}
plot <- ggplot(ratings_title_filtered, aes(x = startYear, y = runtimeMinutes, color = factor(oscarStatus))) +
  geom_point(size=0.5, alpha=0.7, position=position_dodge(width = 0.1))

ggsave("runtime_vs_years.png", plot, width=4, height=3)
```

```{r}
prop.table(table(ratings_title_filtered$genre, ratings_title_filtered$oscarStatus),1)

ratings_title_filtered %>% filter(oscarStatus == "Won")

ratings_title_filtered %>% filter(tconst=="tt1010048")
```

RidgeDensity'e bakarsak noir, mystery, musical, history, biography filmleri daha yüksek puanlanýyor

numVotes'a baktýðýmýzda bir yanda noir-musical-western gibi early peakler var, diðer yanda animation, adventure, fantasy gibi genel daðýlýmlar
```{r}

ggplot(data=ratings_title_filtered %>% filter(!genre %in% c(NA, "sport", "news", "film", "fi", "documentary", "adult")), aes(x=numVotes, y=genre, fill=genre)) +
  geom_density_ridges(scale=2, rel_min_height = 0.09) +
  scale_x_log10(labels = comma) +
  theme_minimal()

ratings_title_filtered <- ratings_title_filtered %>% filter(!genre %in% c(NA, "sport", "news", "film", "fi", "documentary", "adult"))

genre_prop <- prop.table(table(ratings_title_filtered$genre, ratings_title_filtered$oscarStatus),1) %>% as.data.frame

exclude_these <- c(NA, "sport", "news", "film", "fi", "documentary", "adult","music","family","western")
turk_labels <- c("Aksiyon", "Macera", "Animasyon","Biyografi","Komedi","Suç","Dram","Fantastik","Tarih","Korku","Müzikal","Gizem","Noir","Romantik","Bilim-Kurgu","Gerilim","Savaþ")


#finished plot #1 -- türlere göre oscar baþarýsý
plot <- ggplot(data=genre_prop %>% filter(!Var2=="None") %>% filter(!Var1 %in% exclude_these), aes(x=Var1,y=Freq, fill=Var2)) +
  geom_col() +
  theme_minimal(base_size = 16) +
  theme(axis.text.x = element_text(angle = 90, hjust=1.2, vjust=0.25), axis.title.x = element_blank(), legend.position = c(0.8,0.9), plot.subtitle = element_text(color="#666666"), plot.title = element_text(face="bold"))+
  scale_x_discrete(labels = turk_labels) +
  scale_y_continuous(labels=scales::percent) +
  labs(y = "Adaylýk & Kazanma Oraný", title="Türlere Göre Oscar Baþarýsý", subtitle="her bir türdeki filmlerin yüzde kaçý aday olmuþ veya kazanmýþ?") +
  scale_fill_hue(name=NULL, labels=c("Kazanamayan Adaylar", "Kazananlar"), l=50)

ggsave("chart1.png", plot, width=8, height=6)

ratings_title_filtered %>% filter(genre=="history" & oscarStatus %in% c("Won","Nominated"))

#finished plot #2 -- türlere göre imdb puaný
plot2 <- ggplot(data=ratings_title_filtered %>% filter(!genre %in% exclude_these), aes(x=averageRating, y=genre, fill=genre)) +
  geom_density_ridges(scale=1.75, rel_min_height = 0.1, alpha=0.6) +
  theme_minimal(base_size = 14) + 
  theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="#666666", margin=margin(0,0,20,0)), plot.title = element_text(face="bold"), axis.text.y=element_text(face=c("plain", "plain","plain","bold","plain","plain","plain","plain","bold","plain","plain","plain","plain","plain","plain","plain","bold","plain"))) +
  scale_fill_hue(l=30, guide=FALSE) +
  scale_y_discrete(labels = turk_labels) +
  labs(x = "IMDb Puaný", title="Türlere Göre IMDb Puanlarý", subtitle="farklý türlerin puanlarý nerede yoðunlaþýyor?")

ggsave("chart2.png", plot2, width=8, height=6)

#finished plot #3 -- number of movies per genre

noMovies <- ratings_title_filtered %>% group_by(genre) %>% filter(!genre %in% exclude_these) %>%  summarise(noMovies = n())
noMovies <- noMovies %>% mutate(colored = ifelse(genre %in% c("war", "history", "biography"), "1", "0"))

plot3 <- ggplot(data=noMovies, aes(x=genre, y=noMovies, fill=colored)) +
   geom_col(alpha=1) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 90, hjust=1.2, vjust=0.25, face=c("plain", "plain","plain","bold","plain","plain","plain","plain","bold","plain","plain","plain","plain","plain","plain","plain","bold","plain")), axis.title.x = element_blank(), legend.position = c(0.9,0.9), plot.subtitle = element_text(color="#666666"), plot.title = element_text(face="bold", margin=margin(0,0,10,0)))+
  scale_x_discrete(labels = turk_labels) +
  labs(y = "Film Sayýsý", title="1934-2017 Arasý Yayýnlanan Filmlerin Türlere Daðýlýmý") +
  scale_fill_hue(name=NULL, l=50, guide=FALSE) +
  scale_y_continuous(label=comma)

ggsave("chart3.png", plot3, width=8, height=6)

ratings_title_filtered %>% group_by(genre, oscarStatus) %>% summarise(awards = n())

#finished plot #4 -- length vs award

plot4 <- ggplot(data=ratings_title_filtered %>% filter(!genre %in% exclude_these), aes(x=startYear, y=runtimeMinutes, color=oscarStatus)) +
  geom_smooth(size=1.25, se=F) +
  theme_minimal(base_size = 14) +
  theme(axis.title.x = element_blank(), legend.position = c(0.9,0.9), plot.subtitle = element_text(color="#666666"), plot.title = element_text(face="bold"))+
  labs(y = "Film Uzunluðu (dk)", title="Yýldan Yýla Film Uzunluklarý ve Oscar Baþarýsý", subtitle="yýllar boyu Oscar'a aday olan, olamayan ve ödülü kazanan filmlerin ortalama uzunluðu") +
  scale_x_continuous(breaks=pretty_breaks(12)) +
  scale_color_manual(values = c("#9999CC", "#CC6666", "#66CC99"), breaks = c("Won", "Nominated", "None"), labels=c("Kazananlar", "Kazanamayan Adaylar", "Aday Olamayanlar"),guide_legend(title=""))

ggsave("chart4.png", plot4, width=10, height=7.25)
```

Lead actor/aktrisin yaþý (adding lead info for further use)


```{r}
title_principles <- title_principles %>% class

ratings_title_filtered_2 <- title_principles %>% 
  filter(category %in% c("actor", "actress")) %>% 
  select(tconst, ordering, nconst, category) %>%
  group_by(tconst) %>%
  filter(ordering == min(ordering)) %>% 
  left_join(name_basics) %>% 
  select(nconst, tconst, birthYear) %>% 
  left_join(ratings_title_filtered) %>% 
  mutate(leadAge = startYear - birthYear)

ggplot(data=ratings_title_filtered_2 %>% filter(!genre %in% exclude_these), aes(x=leadAge, y=genre)) +
  geom_density_ridges(scale=1.5, rel_min_height = 0.09) +
  theme_minimal()

ggplot(data=ratings_title_filtered_2 %>% filter(!genre %in% exclude_these), aes(x=startYear, y=leadAge, color=oscarStatus)) +
  geom_smooth(method=lm)
  
```

lead gender
```{r}
ratings_title_filtered_3 <- title_principles %>% 
  filter(category %in% c("actor", "actress")) %>% 
  select(tconst, ordering, nconst, category) %>%
  group_by(tconst) %>%
  filter(ordering == min(ordering)) %>% 
  left_join(name_basics) %>% 
  select(nconst, tconst, birthYear, category) %>% 
  left_join(ratings_title_filtered)

gender_dist <- prop.table(table(ratings_title_filtered_3$genre, ratings_title_filtered_3$category),1) %>% as.data.frame

plot4 <- ggplot(data = gender_dist %>% filter(!Var1 %in% exclude_these), aes(x=Var1, y=Freq, fill=Var2)) +
  geom_col() +
   theme_minimal(base_size=12) +
  theme(axis.text.x = element_text(angle = 90, hjust=1.2, vjust=0.25), axis.title.x = element_blank(), legend.position = c(0.9,1.05), plot.subtitle = element_text(color="#666666"), plot.title = element_text(face="bold"))+
  scale_x_discrete(labels = turk_labels) +
  scale_y_continuous(labels=scales::percent) +
  labs(y = "Baþrol Görevi Verilen Film Yüzdesi", title="Türlere Göre Baþrol Oyuncusunun Cinsiyet Daðýlýmý", subtitle="aktris ve aktör baþrollerden, hangileri, hangi türlerde daha sýk görülüyor?") +
  scale_fill_hue(name=NULL, labels=c("Aktör","Aktris"),l=50)

ggsave("chart4.png", plot4, width=8, height=6)

```


Gender of lead
```{r}
# gender vs rating
plot2 <- ggplot(data=ratings_title_filtered, aes(x=averageRating, fill=category)) +
  geom_density(alpha=0.2)
ggsave("gender-vs-rating.png", plot2, width=4, height=3)


# years vs leadage per gender
ggplot(data=ratings_title_filtered %>% group_by(category, startYear) %>% summarize(leadAge = median(leadAge, na.rm = TRUE)), aes(x=startYear, y=leadAge, fill=category)) +
  geom_smooth() 

plot1 <- ggplot(data=ratings_title_filtered %>%filter(str_detect(category, "actress")) %>% group_by(category, startYear) %>% summarize(leadAge = median(leadAge, na.rm = TRUE)), aes(x=startYear, y=leadAge, color="red")) +
  geom_line(model=lm) +
  geom_line(data=ratings_title_filtered %>% filter(oscarStatus %in% c("Nominated") & str_detect(category, "actress")) %>%  group_by(category, startYear) %>% summarize(leadAge = median(leadAge, na.rm = TRUE)), color="blue", model=lm) +
  geom_line(data=ratings_title_filtered %>% filter(oscarStatus %in% c("Won") & str_detect(category, "actress")) %>%  group_by(category, startYear) %>% summarize(leadAge = median(leadAge, na.rm = TRUE)), color="green", model=lm)

ggsave("actress-age-oscar.png", plot1, width=4, height=3)
```

Yonetmenin kacinci filmi & baþrolün kaçýncý filmi
```{r}
title_ratings_nth <- ratings_title_filtered %>% 
  select(-genre) %>% 
  group_by(nconst) %>%
  arrange(startYear) %>%
  unique %>% 
  mutate(nth_lead = row_number())

title_ratings_nth <- 
  title_ratings_nth %>% 
  rename(lead = nconst) %>% 
  left_join(title_principles %>% filter(str_detect(category, "director"))) %>% 
  rename(director = nconst) %>% select(-category, -characters, -ordering) %>% 
  group_by(director) %>%
  arrange(startYear) %>%
  unique %>%
  mutate(nth_directing = row_number())

title_ratings_nth <- title_ratings_nth %>% filter(!is.na(director) & !is.na(lead))

plot4 <- ggplot(data=title_ratings_nth, aes(x=nth_directing, y=averageRating, color=oscarStatus)) +
  geom_point(size=1, alpha=0.7, position=position_dodge(width = 0.1))

ggsave("nth_directing_vs_rating.png", plot4, width=4, height=3)

plot5 <- ggplot(data=title_ratings_nth, aes(x=nth_lead, y=averageRating, color=oscarStatus)) +
  geom_point(size=0.25, alpha=0.7, position=position_dodge(width = 0.1))

ggsave("nth_lead_vs_rating.png", plot5, width=4, height=3)

prop.table(table(title_ratings_nth$nth_directing, title_ratings_nth$oscarStatus),1)
```
Argo'nun yönetmeni yanlýþ

Ana oscarlar arasýndaki iliþki
```{r}
academy_awards <- academy_awards %>% 
  mutate(Movie = ifelse(Award %in% c("Best Picture", "Directing","Writing (Adapted Screenplay)","Writing (Original Screenplay)"), Name, ifelse(Award %in% c("Actress in a Leading Role", "Actor in a Leading Role", "Actress in a Supporting Role", "Actor in a Supporting Role"), Film, NA)))

academy_awards$Movie <- academy_awards$Movie %>% str_trim


ggplot(data=total_awards, aes(x=TotalAwards)) +
  geom_bar()
  
academy_awards$BigWinner <- 0

academy_awards <- academy_awards %>% 
  mutate(BigWinner = replace(BigWinner, which(Award == "Best Picture" & Winner==1), 1))

total_awards <- academy_awards %>% 
  filter(Winner == 1) %>% 
  group_by(Movie) %>% 
  summarize(TotalAwards = n_distinct(Award), BigWinner = sum(BigWinner))

total_awards$BigWinner <- as.logical(total_awards$BigWinner)

plot6 <- ggplot(data=total_awards, aes(x=TotalAwards, fill=BigWinner)) +
  geom_bar(position="stack")

ggsave("totalawards_vs_bestpicture.png", plot6, width=4, height=3)

```

Fix it motherfucker
uyuyoken bir daha deneyelim:
```{r}
proper_filtered <- ratings_title %>% filter(numVotes > 1000 & titleType == "movie" & startYear > 1934)

tconst_vector <- proper_filtered %>% select(tconst) %>% unlist %>% unname %>% as.vector
tconst_vector_new <- ratings_title_filtered %>% select(tconst)

url <- "https://www.imdb.com/title/"

country_data_full <- NULL

for (tconst in tconst_vector) {
  url_new <- paste(url,tconst, sep="")
  webpage <- read_html(url_new)
  country_data_html_full <- html_nodes(webpage,".txt-block:nth-child(4) , #titleDetails h2+ .txt-block , #titleDetails h2")
  country_data_full <- rbind(country_data_full, html_text(country_data_html_full))
}

tconst_vector %>% length
country_data_full %>% tail

country_data_full_df <- data.frame(Col2 = country_data_full[,2], Col3 = country_data_full[,3])
country_data_full_df$Combi <- NA
country_data_full_df$Combi <- paste(country_data_full_df$Col2, country_data_full_df$Col3)
country_data_full_df$Combi[22]

countries_full <- str_extract(country_data_full_df$Combi, ".*Country:\n.*([[:alpha:]]).*") %>% strsplit("Country:\n")
countries_full[[2]][2]
countries_full <- countries_full %>% unlist
countries_full %>% length
countries_full_df <- data.frame(Countries = countries_full)
countries_full_df <- countries_full_df %>% filter(str_detect(Countries, regex("\\w")))
countries_full_df %>% nrow


### for loop ile ülkeleri alalým ki boþ olanlar ortaya çýksýn
countries_loop <- NULL

for (number in c(1:23223)) {
  countries_loop <- rbind(countries_loop, countries_full[[number]][2])
}

countries_loop %>% length
countries_loop_df <- data.frame(Country = countries_loop)
countries_loop_df$Country <- as.character(countries_loop_df$Country)

countries_loop_df <- cbind(tconst_vector, countries_loop_df)
countries_loop_df <- countries_loop_df %>% rename(tconst = tconst_vector)

full_tconst_new <- tconst_vector_new %>% left_join(countries_loop_df)
missing_tconst <- full_tconst_new %>% filter(Country %>% is.na) %>% select(tconst) %>% unlist %>% unname %>% as.vector

country_data_missing <- NULL

for (tconst in missing_tconst) {
  url_new <- paste(url,tconst, sep="")
  webpage <- read_html(url_new)
  country_data_html_missing <- html_nodes(webpage,".txt-block:nth-child(4) , #titleDetails h2+ .txt-block , #titleDetails h2")
  country_data_missing <- rbind(country_data_missing, html_text(country_data_html_missing))
}

country_data_missing %>% as.data.frame

country_data_missing_df <- data.frame(Col2 = country_data_missing[,2], Col3 = country_data_missing[,3])
country_data_missing_df$Combi <- NA
country_data_missing_df$Combi <- paste(country_data_missing_df$Col2, country_data_missing_df$Col3)
country_data_missing_df$Combi[22]

countries__missing_nomore <- str_extract(country_data_missing_df$Combi, ".*Country:\n.*([[:alpha:]]).*") %>% strsplit("Country:\n")
countries__missing_nomore %>% length
countries_missing_loop <- NULL
for (number in c(1:3189)) {
  countries_missing_loop <- rbind(countries_missing_loop, countries__missing_nomore[[number]][2])
}

countries_missing_loop_df <- data.frame(Country = countries_missing_loop)
countries_missing_loop_df$Country <- countries_missing_loop_df$Country %>% as.character
countries_missing_loop_df<- cbind(missing_tconst, countries_missing_loop_df)
countries_missing_loop_df <- countries_missing_loop_df %>% rename(tconst = missing_tconst)
countries_missing_loop_df$tconst <- countries_missing_loop_df$tconst %>% as.character

full_tconst_new <- full_tconst_new %>% left_join(countries_missing_loop_df, by="tconst") %>% mutate(Country = paste(Country.x, Country.y, sep="")) %>% select(tconst, Country)

full_tconst_new$Country <- gsub("NA", "",full_tconst_new$Country, perl=T) %>% str_trim

full_tconst_new_country <- full_tconst_new %>% select(Country)

countries_missing_loop_df[which(countries_missing_loop_df$tconst=="tt0876563"), "tconst"] == full_tconst_new[which(full_tconst_new$tconst=="tt0876563"), "tconst"]

```


This part is pathetic
```{r}
proper_filtered <- ratings_title %>% filter(numVotes > 1000 & titleType == "movie" & startYear > 1934)

tconst_vector <- proper_filtered %>% select(tconst) %>% unlist %>% unname %>% as.vector

url <- "https://www.imdb.com/title/"

country_data <- NULL
country_data2 <- NULL


for (tconst in tconst_vector[tr_vector[2445:length(tr_vector)]]) {
  url_new <- paste(url,tconst, sep="")
  webpage <- read_html(url_new)
  country_data_html2 <- html_nodes(webpage,".txt-block:nth-child(4) , #titleDetails h2+ .txt-block , #titleDetails h2")
  country_data2 <- rbind(country_data2, html_text(country_data_html2))
}

country_data2 %>% head


country_data <- gsub(".*\\((.*)\\).*", "\\1", country_data)

country_data_df <- data.frame(country = country_data)

country_data_df$country <- as.character(country_data_df$country)

country_data_df <- country_data_df %>% mutate(country = replace(country, which(country == "Turkey"), "TBD"))

tr_vector <- which(country_data_df$country == "TBD")

country_data2_df <- data.frame(Col2 = country_data2[,2], Col2 = country_data2[,3])

country_data2_df$Combi <- paste(country_data2_df$Col2, country_data2_df$Col2.1)

countries <- str_extract(country_data2_df$Combi, ".*Country:\n.*([[:alpha:]]).*") %>% strsplit("    Country:\n        ")

countries <- countries %>% unlist

countries_df <- data.frame(Countries = countries)

countries_df <- countries_df %>% filter(!Countries=="")

country_data_df %>% filter(country=="TBD")

tbds <- which(country_data_df$country=="TBD")

country_data_df[tbds, "country"] <- countries_df$Countries

country_data_df[tbds, "country"] %>% length

tconst_vector[tr_vector[countries_df$Countries[52]]]

which(!countries_df$Countries == "USA")
```

```{r}
exclude_these <- c(NA, "sport", "news", "film", "fi", "documentary", "adult", "music","family","western")

plot_1 <- ggplot(data=genre_prop %>% filter(!Var2=="None") %>% filter(!Var1 %in% exclude_these), aes(x=Var1,y=Freq, fill=Var2)) +
  geom_col() +
  theme_minimal(base_size = 16) +
  theme(axis.text.x = element_text(angle = 90, hjust=1.2, vjust=0.25), axis.title.x = element_blank(), legend.position = c(0.8,0.9), plot.subtitle = element_text(color="#666666"), plot.title = element_text(face="bold")) +
  scale_y_continuous(labels=scales::percent) +
  labs(y = "Ratio from all movies within same genre", title="Oscar Performances Per Genre", subtitle="Oscar Performances Per Genre", subtitle="percentage of movies from each genre winner/nominee for the Best Picture") +
  scale_fill_hue(name=NULL, labels=c("Nominated", "Won"), l=50)

ggsave("chart_1.png", plot_1, width=8, height=6)


plot_2 <- ggplot(data=ratings_title_filtered %>% filter(!genre %in% exclude_these), aes(x=averageRating, y=genre, fill=genre)) +
  geom_density_ridges(scale=1.75, rel_min_height = 0.1, alpha=0.6) +
  theme_minimal(base_size = 14) + 
  theme(axis.title.y = element_blank(), plot.subtitle = element_text(color="#666666", margin=margin(0,0,20,0)), plot.title = element_text(face="bold"), axis.text.y=element_text(face=c("plain", "plain","plain","bold","plain","plain","plain","plain","bold","plain","plain","plain","plain","plain","plain","plain","bold","plain"))) +
  scale_fill_hue(l=30, guide=FALSE) +
  labs(x = "IMDb Score", title="IMDb Score Per Genre", subtitle="how are IMDb scores distributed for each genre?")

ggsave("chart_2.png", plot_2, width=8, height=6)

noMovies <- ratings_title_filtered %>% 
  group_by(genre) %>% 
  filter(!genre %in% exclude_these) %>%  
  summarise(noMovies = n()) %>% 
  mutate(colored = ifelse(genre %in% c("war", "history", "biography"), "1", "0"))

plot_3 <- ggplot(data=noMovies, aes(x=genre, y=noMovies, fill=colored)) +
   geom_col(alpha=1) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 90, hjust=1.2, vjust=0.25, face=c("plain", "plain","plain","bold","plain","plain","plain","plain","bold","plain","plain","plain","plain","plain","plain","plain","bold","plain")), axis.title.x = element_blank(), legend.position = c(0.9,0.9), plot.subtitle = element_text(color="#666666"), plot.title = element_text(face="bold", margin=margin(0,0,10,0))) +
  labs(y = "Number of Movies", title="Genre Distribution of Movies Released Between 1934-2017") +
  scale_fill_hue(name=NULL, l=50, guide=FALSE) +
  scale_y_continuous(label=comma)

ggsave("chart_3.png", plot_3, width=8, height=6)

plot_4 <- ggplot(data=ratings_title_filtered %>% filter(!genre %in% exclude_these), aes(x=startYear, y=runtimeMinutes, color=oscarStatus)) +
  geom_smooth(size=1.25, se=F) +
  theme_minimal(base_size = 14) +
  theme(axis.title.x = element_blank(), legend.position = c(0.9,0.9), plot.subtitle = element_text(color="#666666"), plot.title = element_text(face="bold"))+
  labs(y = "Duration (min)", title="Durations and Oscar Success Throughout the Years", subtitle="average duration of regular movies, oscar winners and nominees") +
  scale_x_continuous(breaks=pretty_breaks(12)) +
  scale_color_manual(values = c("#9999CC", "#CC6666", "#66CC99"), breaks = c("Won", "Nominated", "None"), labels=c("Won", "Nominated", "None"), guide_legend(title=""))

ggsave("chart_4.png", plot_4, width=8, height=6)
```

